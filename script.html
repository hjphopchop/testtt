
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">


  </head>

  <body>


    <div class="container-fluid toggled" id="wrapper">
      <div class="row">  	
	
		
        	
	<main role="main" class="col-12 ml-sm-auto pt-3 px-4">	
		
	
	
        <div class="col-md-12">
                    

                    	                    
                    
                                            <h1 class="h2">Расстояние/цена доставки</h1>
                        <div class="my-3"><p></p></div>
                                            
                                            
                    		

                    			
		

        </div>
        <!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Вычисление маршрутов</title>
<script src="//ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="//api-maps.yandex.ru/2.0-stable/?load=package.full&amp;lang=ru-RU&amp;coordorder=longlat&amp;apikey=6443ebeb-4ad1-4f6b-835f-a94a175dc79a" type="text/javascript"></script>
<style>
/*
* {padding:0;margin:0;}
body {font:100%/1.3 Arial;color:#333;}
*/
#vsego {position:absolute;z-index:1000000;width:3em;height:3em;line-height:3em;border-radius:3em;background-color:#000;opacity:.7;color:#fff;left:5em;top:5em;text-align:center;}

#map {width:100%;height:32em;}

#in {display:none;}

#out {border-collapse:collapse;width:100%;}
#out tbody tr:hover {background-color:#ffd;}
#out tbody tr.act:hover {background-color:#fee;}
#out td {padding:.3em .5em;border:1px solid #ddd;}
#out thead {background-color:#5a0;color:#fff;}
#out tr.act {background-color:#fdd;}

.l50 {width:30%;}
.r50 {width:70%;box-sizing:border-box;padding-left:1em;padding-right:1em;}

.l50,.r50 {float:left;}

.btn {cursor:pointer;display:inline-block;border:1px solid #eee; padding:.3em .8em;border-radius:.2em;}

</style>
</head>
<body>
<textarea id="in">49512A;г.Москва, ул. Липецкая, 52;26.09.20 08:00-08:30; ;Воздушные шары с героями м/ф Тачки - 3|Букет шаров  Чейз, Маршалл, Скай и шары хром - 1|Шар-цифра 3 синяя с гелием - 1|Латексные шарики Смайлы - 10|
49274A;г.Москва,  Тверская улица, 3;26.09.20 08:00-09:00; ;Шар-цифра 1 золото с гелием - 1|Фигурный шар Улитка Гэри - 1|Композиция из ярких фольгированных звёзд и золотой цифры - 1|Фигурный шар Губка Боб, в полный рост - 1|Фигурный шар Ананас - 1|
49465A;г.Москва, пр-д. Лазоревый, 13;26.09.20 08:00-10:00; ;Шары Гравити Фолз - 18|
49744A;г.Москва, пер. Протопоповский, 38;26.09.20 09:00-14:00; ;Шар Цифра 1 нежно-розовая, 101 см - 1|Шар-звезда Нежно-розовый, 46 см - 1|Фигурный шар Розовый фламинго, 130см - 1|Шары с гелием нежно-розовые - 15|Шар-сердце Нежно-розовый, 46 см - 1|Фольгированный шар-гирлянда Happy B-day, розовое золото, 90 см - 1|
49757C;рп.Новоивановское, ул. Агрохимиков, 19;26.09.20 09:00-11:00; ;Ходячий шар Человек-паук, 91 см - 1|Шары с гелием цветное ассорти - 7|Грузик стандартный - 1|
49629A;г.Москва, ул. Соловьиная Роща, 8;26.09.20 09:00-10:30; ;Язычок-гудок Праздничный торт 6шт - 1|Колпачок Праздничный торт, 6 шт - 1|Шары Хештеги на день рождения, разноцветные - 8|Фигурный шар Торт со свечами, Розовый, 79 см - 1|Шары с гелием цветное ассорти-хром - 13|Гирлянда С Днем Рождения, Пончики, 255 см - 1|
49679A;г.Москва, ул. Щорса, 8;26.09.20 09:00-10:30; ;Букет шаров на 1 годик для девочки, нежность - 1|Шар-цифра 1 серебро с гелием - 1|
49691A;г.Москва, ул. Куусинена, 4;26.09.20 09:30-13:00; ;Шар-цифра 2 Жираф с гелием - 1|Шары С днём рождения, детские - 15|Грузик стандартный - 2|
49675A;г.Москва, ул. Гастелло, 14;26.09.20 10:00-12:00; ;Шары с гелием нежно-розовые - 6|Шары Конфетти, перламутровая золотая крошка - 6|
49643A;г.Москва, ул. Вересковая, 1;26.09.20 10:00-10:00; ;Шары с гелием цветное ассорти - 45|
49660A;г.Москва, ул. Мосфильмовская, 70;26.09.20 10:00-11:05; ;Букет шаров С двумя цифрами - 1|Шар Цифра 2 золотая, 101 см - 2|Шар-звезда Золотой, 46 см - 2|
49733A;г.Москва, ул. Дубнинская, 35;26.09.20 10:06-14:07; ;Букет шаров Леди Баг чёрно-красный со звёздами - 1|
49649A;г.Москва, ул. Заповедная, 8;26.09.20 10:30-12:00; ;Шары Малиновые металлик - 3|Шары Нежно-фиолетовые металлик - 2|Шар Цифра 1 розовая, 101 см - 1|Шар Цифра 8 розовая, 101 см - 1|Шар-звезда Розовый, 46 см - 1|Шары Ярко-розовые сердца, 41 см - 2|Шары Розовое золото металлик - 3|Грузик стандартный - 3|
49534A;г.Москва, пр-кт. Мира, 102c30;26.09.20 11:00-13:00; ;Шары Цветное ассорти-металлик - 15|Фигурный шар Кекс с Днем рождения, голубой - 1|Шар Цифра 1 золотая, 101 см - 1|Шары Маленький принц, перламутр - 15|
49704A;г.Москва, ул. Автозаводская, 18;26.09.20 11:30-12:30; ;Шары Для принцессы - 15|Пневмохлопушка в розовой тубе с цветным конфетти фольга, 30см - 2|
49437A;г.Москва, ул. Ярославская, 13Аc1;26.09.20 11:30-12:30; ;Грузик для шаров Конус перламутр, 170 г - 2|Шары Тропические листья - 30|
49174C;,  улица Самуила Маршака, 2;26.09.20 13:00-15:00; ;Шары Хештеги на день рождения, прозрачные - 30|Шар Цифра 1 серебряная, 101 см - 1|Шар Цифра 8 серебряная, 101 см - 1|
49405A;рп.Малаховка, ул. Новомалаховская, 32А;26.09.20 13:00-16:00; ;Шары Оскорбительные для нее - 10|Шары Ты лучше всех - 5|Грузик стандартный - 1|
49641A;г.Москва, ул. Машиностроения 1-я, 10;26.09.20 13:30-14:30; ;Шары С днём рождения Оторвись! - 15|
49299A;г.Москва, ул. Бахрушина, 1c1;26.09.20 16:00-21:00; ;Шары Эмоции с гелием - 15|Шар-круг С днем рождения, Три кота, синий, 46 см - 1|Фигурный шар Экскаватор, 81 см - 1|Шары Три Кота, белые - 25|
49652A;г.Москва,  Парковая улица, 7;26.09.20 16:00-17:00; ;Фонтан шаров с гелием Тачки - 1|
49637A;г.Москва, пер. Новолесной, 5;26.09.20 16:00-17:00; ;Фигурный шар Миньон Стюарт, 78 см - 1|Трубочки для коктейля Миньоны, 6 шт. - 2|Тарелки бумажные Миньоны 23 см, 8 шт. - 4|
49479A;г.Москва, ул. Правды, 24c3;26.09.20 17:00-19:15; ;Шары Весёлый Роджер - 20|
49715A;г.Москва, ул. Кузнецкий Мост, 6/3;26.09.20 18:00-19:00; ;Шары Хештеги на день рождения, прозрачные - 10|Шары Оскорбительные для нее - 10|
49595A;г.Москва, ул. Садовая-Кудринская, 3А;26.09.20 19:00-19:45; ;Сет воздушных шаров на девичник с вашими поздравлениями - 1|
49745A;г.Москва, ул. Святоозерская, 22;26.09.20 21:00-22:00; ;Воздушные шары Белое Золото - 6|Фигурный шар Губка Боб, в полный рост - 1|Фигурный шар Сова - 1|
49591A;г.Москва, пр-д. Береговой, 5А;26.09.20 22:00-23:00; ;Шары Маленький принц, перламутр - 30|Шары Милые Зверята - 25|Фигурный шарик Кошечка голубая, 93 см - 1|
49419A;г.Москва, ул. Ивовая, 6;26.09.20 22:00-23:00; ;Фигурный шар Тачка голубая, 80 см - 1|Шар Цифра 5 синяя, 101 см - 1|Шар-подушка Щенячий патруль Happy Birthday, 43 см - 1|Шары Робокар Поли - 3|Фигурный шар Тачка Красная, 82 см - 1|
</textarea>

<div class="r50">
<table id="out"><thead>
<tr><td></td>
<td>Номер</td>
<td>Адрес</td>
<td>Дата время</td>
<td>Цена<br>доставки</td>
<td>Км</td>
<td>Км</td>
<td>Км</td></tr>
</thead>
<tbody></tbody>
</table>

<br><br>

<div id="get_adr" class="btn">Обновить адреса</div>
</div>
<div class="l50"><div id="vsego"></div><div id="map"></div></div>
<script>
$(function() {
ymaps.ready(function() {

var myMap=new ymaps.Map("map",{
center:[37.62,55.74],
zoom:10,
behaviors:['scrollZoom']
});

myMap.behaviors.get('drag').enable();
myMap.controls.add('zoomControl');

var sel_btn=new ymaps.control.Button({data:{content:"Только выделенные"},options:{selectOnClick:true,maxWidth:120}});
sel_btn.events.add('click',function(){show_hide_selected(sel_btn.isSelected());});
myMap.controls.add(sel_btn,{top:10,left:10});

//.add('mapTools')

var zona=[];
var metki=[];
var input=[];

//очистить таблицу и карту с метками
function reset(){
$("#out input").each(function() {
nomer=$(this).attr("data-nomer");
myMap.geoObjects.remove(metki[nomer]);
});
$("#out tbody").html("");
metki=[];
$("#vsego").html("").show();
sel_btn.deselect();
}

//зоны на карте и их параметры (имя, цена, цвет, прозрачность)
//зон может быть много
//нулевая зона - это вся карта, параметры у неё чисто формальные, на карте она не рисуется
//по умолчанию зоны включаются одна в другую, но при этом надо соблюдать условие:
//начинаем задавать от самой большой зоны к самой маленькой
/*zona[0]={ima:'Вся карта',cena:750,cvet:'#fff',proz:'50'};
zona[1]={ima:'Москва',cena:750,cvet:'#ed4543',proz:'50'};
zona[2]={ima:'Москва',cena:650,cvet:'#177bc9',proz:'50'};
zona[3]={ima:'Москва',cena:550,cvet:'#ffd21e',proz:'50'};
zona[4]={ima:'Москва',cena:500,cvet:'#97a100',proz:'50'};
zona[5]={ima:'Москва',cena:400,cvet:'#f371d1',proz:'50'};*/
zona[0]={ima:'Вся карта',cena:700,cvet:'#fff',proz:'50'};
zona[1]={ima:'Москва',cena:700,cvet:'#ed4543',proz:'50'};
zona[2]={ima:'Москва',cena:600,cvet:'#177bc9',proz:'50'};
zona[3]={ima:'Москва',cena:500,cvet:'#ffd21e',proz:'50'};
zona[4]={ima:'Москва',cena:450,cvet:'#97a100',proz:'50'};
zona[5]={ima:'Москва',cena:350,cvet:'#f371d1',proz:'50'};

zona[0].xy=[];

//координаты контуров зон, начиная с первой зоны
zona[1].xy=[[37.335273346028906,55.85225184941095],[37.30473906487576,55.807309217287724],[37.31641203850853,55.719041098161895],[37.40944485036822,55.61927366442497],[37.473302882594496,55.596729823688555],[37.590032618922535,55.57611803623217],[37.67998318044618,55.569115333540495],[37.72904310081508,55.58959751819447],[37.792386148910346,55.61952904454584],[37.84268293235786,55.65526131864248],[37.84388456199669,55.69280316562616],[37.84165296409633,55.73224613849262],[37.8447428688815,55.814878606627076],[37.82937917564435,55.83121008676079],[37.780369852524,55.85680476104227],[37.70295057151777,55.892512418395754],[37.645958994369806,55.89694944429918],[37.56081495140122,55.912571435271964],[37.398766611557434,55.88556648529534],[37.335273346028906,55.85225184941095]];

zona[2].xy=[[37.40579871924958,55.677214505917874],[37.49249372337431,55.60942486071238],[37.62497849967795,55.63568897816993],[37.70668931510766,55.66170385685036],[37.779156205359214,55.715438645065724],[37.78018617362087,55.73733283654742],[37.77022981375762,55.7661833257002],[37.74070405692165,55.8099022388611],[37.66860627860138,55.841982981356836],[37.58346223563262,55.86264745231934],[37.480465409460756,55.855503042264665],[37.389141556921714,55.833482239795885],[37.35279376254276,55.79312031633498],[37.356271407616866,55.73606122453634],[37.40579871924958,55.677214505917874]];

zona[3].xy=[[37.65871402644886,55.69997544466667],[37.720683783528905,55.72255655199563],[37.70587798976679,55.7359003768783],[37.706178397176416,55.7442046555676],[37.69991275691762,55.75925920008472],[37.69866821193476,55.76988100168419],[37.681630820272076,55.78088686394441],[37.65716907405644,55.7959271912443],[37.50679370784519,55.810236684850864],[37.447398871419445,55.78016129880763],[37.384570807454736,55.76206615453103],[37.43400928401703,55.68203690276238],[37.48550769710312,55.645552551614294],[37.50777383609987,55.65572281012297],[37.53827937934872,55.65328902690314],[37.5660383405663,55.654737501371606],[37.59713050746689,55.69495833385319],[37.6249825658775,55.70244740635488],[37.65871402644886,55.69997544466667]];

zona[4].xy=[[37.58464214229325,55.76000935452327],[37.566188544270936,55.763566340256496],[37.53331539058436,55.766252011538604],[37.50147220515972,55.75461276086968],[37.437785834310105,55.735004474219195],[37.44413730525731,55.72236277872404],[37.459930151936945,55.69057086176743],[37.48018619441741,55.68126099578363],[37.55400058650726,55.72236277872404],[37.58661624812821,55.737958454107925],[37.600005835530695,55.75296701358875],[37.58464214229325,55.76000935452327]];

zona[5].xy=[[37.571086604879845,55.74909490476485],[37.56971331386423,55.75364519540506],[37.52971621303414,55.74163902126144],[37.52473803310249,55.754613273572886],[37.47804613857124,55.744350417187654],[37.50242205409858,55.712770297885086],[37.543277461813425,55.74062219902031],[37.571086604879845,55.74909490476485]];

//яндекс выдаёт расстояние в метрах, это функция округления до км
function m_to_km(a) {return Math.round(a/1000).toString();}

//функция запускается, когда просчитаны все адреса
function gotovo() {
$("#vsego").html(0).fadeOut();
$("#out input").change(function() {
nomer=$(this).attr("data-nomer");

if($(this).is(":checked")) {
metki[nomer].options.set('preset','twirl#redStretchyIcon');
metki[nomer].options.set('visible',true);
$(this).parent().parent().addClass('act');
} else {
metki[nomer].options.set('preset','twirl#blueStretchyIcon');
$(this).parent().parent().removeClass('act');
}

});
}

//отрисовка зон на карте
for(var i=1;i<zona.length;i++) {
if(i==zona.length-1) {var kpol=[zona[i].xy];} else {var kpol=[zona[i].xy,zona[i+1].xy];}
//hintContent: zona[i].ima
zona[i].polygon=new ymaps.Polygon(kpol, {}, {fillColor: zona[i].cvet+zona[i].proz,strokeColor: zona[i].cvet,strokeWidth: 0});
myMap.geoObjects.add(zona[i].polygon);
}

//определить номер зоны по координатам
function nzony(b) {
var i=1, nzon=0;while((i<zona.length)&&(nzon==0)) {if(zona[i].polygon.geometry.contains(b)) {nzon=i;} i++;}return(nzon);
}

//переход к следующему адресу (даже при ошибке)
function dalee() {

if (input.length!=0) {
$("#vsego").html(input.length);
var stroka=input[0].split(";");
var nomer=stroka[0];
var finish=stroka[1];
var dat=stroka[2];
var courier=stroka[3];
var sostav=stroka[4].split("|");
var tovary=sostav.join("<br>");

input.shift();

//точка старта (например, координаты склада)
var start_xy=[37.62,55.74];

//геокодирование финиша
ymaps.geocode(finish).then(function(res) {

//координаты финиша
var finish_xy=res.geoObjects.get(0).geometry.getCoordinates().toString().split(",");

//создаем метку и добавляем на карту
//чтобы потом можно было обратиться к конкретной метке, сохраняем её в массиве
metki[nomer]=new ymaps.Placemark(finish_xy, {
nomer: nomer,
iconContent:nomer+" "+dat.split(" ")[1]
}, {preset: 'twirl#blueStretchyIcon'});
myMap.geoObjects.add(metki[nomer]);

metki[nomer].events.add('click',function(e){
zak_metka=e.get('target');
nomer=zak_metka.properties.get('nomer');

$("#out input[data-nomer='"+nomer+"']").click();

});

//построение маршрута
ymaps.route([start_xy, finish_xy]).then(function(tuda) {
var probeg=tuda.getLength();

//вывод в таблицу
$("#out tbody").append('<tr><td><input type="checkbox" data-nomer="'+nomer+'"></td><td>'+nomer+'</td><td>'+courier+'</td><td>'+tovary+'</td><td>'+finish+'</td><td>'+ dat+'</td><td>'+zona[nzony(finish_xy)].cena+' Р</td><td>'+m_to_km(probeg)+' км</td></tr>');
dalee(); //переход к следующему адресу

},
function(err) {
alert(finish+'Ошибка при подсчёте маршрута: '+err.message);
dalee();
})

},
function(err){
alert(finish+'Ошибка геокодирования финиша');
dalee();
})
} else {
gotovo();
}
}

/*
function zak_toggle(nomer) {
zak_checkbox=$("#out input[data-nomer='"+nomer+"']");
if($(zak_checkbox).is(":checked")) {
metki[nomer].options.set('preset','twirl#blueStretchyIcon');
$(zak_checkbox).parent().parent().removeClass('act');
//myMap.geoObjects.add(metki[nomer]);
} else {
metki[nomer].options.set('preset','twirl#redStretchyIcon');
$(zak_checkbox).parent().parent().addClass('act');
//myMap.geoObjects.remove(metki[nomer]);
}
}
*/

function show_hide_selected(arg) {
$("#out input").each(function() {
nomer=$(this).attr("data-nomer");
if(arg) {
metki[nomer].options.set('visible',true);
} else {
if($(this).is(":checked")) {
metki[nomer].options.set('visible',true);
} else {
metki[nomer].options.set('visible',false);
}
}
});
}

function go() {
input=$("#in").val().split("\n");
input.pop();
dalee();
}

$('#get_adr').click(function() {
reset();
go();
});

go();

})
});
</script>
</body>
</html>        </main>
      </div>
    </div>
        <!-- Custom Styles
    ================================================== -->	
	<style>
            /* header */
            .navbar-dark .navbar-brand {
                    padding: 0 20px 5px 20px!important;
                    font-size: 1.8rem!important;
            }
            .bg-dark {
                    background-color: #2d5c8f!important;
            }
            /*menu-toggle*/
            #menu-toggle {
                position: fixed;
                bottom: 20px;
                left: 10px;   
                z-index: 9999;
            }
            .toggled #menu-toggle {
                opacity: 1;
                top: 10px;
                bottom: auto;
                left: 150px;       
                color: #212529;
                background-color: #f8f9fa;
                border-color: #f8f9fa;                
            }
            .toggled .sidebar {
                display:none!important;
                position: absolute;
            }
            
            /* btn-link*/
            .btn-link-like-link {
                padding: 0;
                font-size: inherit;                
                vertical-align: inherit;                
            }
            
            /*orders-table*/
            .previously_selected {
                /*background-color: #ffc10761;*/
                background-color: #ffc10740;
            }
            /*orders-table*/
            .bad_order {
                background-color: #d00000ad!important;
            }
            .bg-info  a {
                color: #afd5ff!important;
            }
            
            ::placeholder { /* Chrome, Firefox, Opera, Safari 10.1+ */
              color: #cecece!important;
              opacity: 1; /* Firefox */
            }

            :-ms-input-placeholder { /* Internet Explorer 10-11 */
              color: #cecece!important;
            }

            ::-ms-input-placeholder { /* Microsoft Edge */
              color: #cecece!important;
            }                  

            a.anchor {
                display: block;
                position: relative;
                top: -48px;
                visibility: hidden;
            }
                
	</style>
      
	
    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script  src="/files/assets/libs/jquery-3.5.1.min.js"></script>
    <script  src="/files/assets/libs/jquery.cookie.js"></script>
    
    <script src="/files/assets/libs/popper.min.js"></script>    
    <script src="/files/assets/libs/bootstrap-4.5.0-dist/js/bootstrap.min.js"></script>
    
    <link href="/files/assets/libs/select2/css/select2.min.css" rel="stylesheet" />
    <script src="/files/assets/libs/select2/js/select2.min.js"></script>

    
    

            <link rel="stylesheet" type="text/css" href="/files/assets/libs/DataTables_bootstrap/datatables.min.css"/>

        <script type="text/javascript" src="/files/assets/libs/DataTables_bootstrap/datatables.min.js"></script>
    
        
            <!-- ****************************************************************************************** -->
        <!-- Icons -->
        <link href="/files/assets/libs/open-iconic-master/font/css/open-iconic-bootstrap.css" rel="stylesheet">
        <script src="/files/assets/libs/feather.min.js"></script>
        <script>
            feather.replace()
        </script>        

        <!-- Graphs -->
        
  
                
 
        <!-- Menu Toggle Script -->
        <script>
          /*$("#menu-toggle").click(function(e) {
            e.preventDefault();
            $("#wrapper").toggleClass("toggled");
            $("main").toggleClass("col-12 col-lg-12 col-md-12 col-sm-12");
            $(this).html() == "Свернуть панель" ? $(this).html('Показать панель') : $(this).html('Свернуть панель');
          });*/
          
          
$(document).ready(function() {
    // check the cookie when the page loads, opens it if needed (hidden by default)
    if ($.cookie('currentToggle') === 'visible') {
        togglePanel(true);
    }

    //handle the clicking of the show/hide toggle button
    $('#menu-toggle').click(function() {
        //toggle the panel as required, base on current state
        if ($('#menu-toggle').text() === "Показать панель") {
            togglePanel(true);
        }
        else {
            togglePanel(false);
        }
    });
});

function togglePanel(show) {
    var panel = $('.sidebar');
    var button = $('#menu-toggle');
    if (show) {
        panel.slideUp('slow');
        $("main").toggleClass("col-sm-9 col-md-9 col-lg-10");
        $("#wrapper").toggleClass("toggled");
        button.text('Скрыть панель');
        $.cookie('currentToggle', 'visible', { path: '/' });
    } else {
        panel.slideUp('slow');
        $("main").toggleClass("col-sm-9 col-md-9 col-lg-10");
        $("#wrapper").toggleClass("toggled");
        button.text('Показать панель');
        $.cookie('currentToggle', 'hidden', { path: '/' });
    }
}          
          
          
          
          
          
          
          
          
          
          
          
        </script>
        
	<!-- Custom scripts -->
        
	<!-- Libs for scripts -->
	<script type='text/javascript' src="/files/assets/libs/jquery.inputmask.min.js"></script>
	<script type='text/javascript' src="/files/assets/libs/moment.min.js"></script>
	<script>
            /**/   
            // inputmask 
            /**/   
		$tel = $('input[type="tel"]');
		$tel.attr("placeholder", "+7").inputmask( {
			mask: "+7 (999) 999-99-99",
			showMaskOnHover:false,
			onKeyDown:	function (event, opts) {
			  var val = $(event.target).inputmask("unmaskedvalue");

			  if (val.replace(/\D/g, '').length===2)
				{
					val = val.replace('89','9').replace('79','9');   
					$(this).val(val);
				 }
			},
			onBeforePaste:  function (pastedValue, opts) {
			  var processedValue = pastedValue;
			  if (processedValue.replace(/\D/g, '').length===11)
				{
					processedValue = processedValue.replace(/\D/g, '').replace(/^[87](\d+)/g,'$1');  
				 } 
			 return processedValue;
			}			
		});

            // reuired fields
            var required_label = $('input[required], select[required], textarea[required]').closest('.form-group').find('label:first');

            required_label.map(
                function(){
                    $( this ).html($( this ).html() + ' <span class="text-danger font-weight-bold">*</span>')
                }
            );
    
            /**/    
            // копирование в input datatype
            // https://superuser.com/questions/767863/is-there-a-way-to-paste-a-date-into-a-chrome-date-field + доработка с помощью moment.js
            /**/
            var control_pressed = false;

            function changeInputType(oldObject, oType) {
              var newObject = document.createElement("input");
              newObject.type = oType;
              if(oldObject.size) {newObject.size = oldObject.size;}
              if(oldObject.value) {newObject.value = oldObject.value;}
              if(oldObject.name) {newObject.name = oldObject.name;}
              if(oldObject.id) {newObject.id = oldObject.id;}
              if(oldObject.className) {newObject.className = oldObject.className;}
              oldObject.parentNode.replaceChild(newObject,oldObject);
              newObject.select();
              return newObject;
            }

            function swapToText(date_type) {
                $('input[type="'+date_type+'"]').on("keydown", function(event) {
                if ((event.keyCode == 17) && (control_pressed != true)) {
                  $(this).addClass("revert_date_to_text");
                  changeInputType(this, "text");
                  swapToDate(date_type);
                  control_pressed = true;
                }
              })
            }

            function swapToDate(date_type) {
              $(".revert_date_to_text").on("keyup", function(event) {
                var $input_formats = ["DD-MM-YYYY", "DD-MM-YYYY HH:mm", "HH:mm:ss DD-MM-YY"]; // массив с возможными типами дат
                if ((event.keyCode == 17) && (control_pressed != false)) {
                  $(this).removeClass("revert_date_to_text");
                  if (date_type == 'datetime-local') {
                    $(this).val(moment($(this).val(),$input_formats).format(moment.HTML5_FMT.DATETIME_LOCAL));
                  } else {
                    $(this).val(moment($(this).val(),$input_formats).format(moment.HTML5_FMT.DATE));
                  }
                  changeInputType(this, date_type);
                  swapToText(date_type);
                  control_pressed = false;
                }
              })
            }

            $(function() {
              swapToText('date');
              swapToText('datetime-local');
            });       
	</script>

        
        
      
        
  </body>
</html>

